// Application data
const appData = {
  "user": {
    "name": "Alex Chen",
    "title": "Cybersecurity Analyst",
    "bio": "Passionate about ethical hacking and vulnerability assessment. Currently focusing on advanced penetration testing techniques and security automation.",
    "avatar": "/api/placeholder/120/120",
    "social": {
      "github": "https://github.com/alexchen",
      "linkedin": "https://linkedin.com/in/alexchen",
      "twitter": "https://twitter.com/alexchen_sec"
    }
  },
  "activity": {
    "totalContributions": 847,
    "currentStreak": 23,
    "longestStreak": 47,
    "weeklyData": [
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3],
      [0, 1, 3, 2, 4, 1, 0],
      [1, 2, 0, 1, 2, 3, 1],
      [0, 1, 2, 0, 3, 1, 2],
      [1, 0, 1, 4, 2, 1, 0],
      [2, 3, 1, 0, 1, 2, 3]
    ]
  },
  "courses": [
    {
      "id": 1,
      "title": "Advanced Web Application Penetration Testing",
      "instructor": "Sarah Johnson",
      "progress": 75,
      "thumbnail": "/api/placeholder/300/200",
      "category": "Web Security",
      "duration": "40 hours"
    },
    {
      "id": 2,
      "title": "Network Security Assessment",
      "instructor": "Mike Rodriguez",
      "progress": 45,
      "thumbnail": "/api/placeholder/300/200",
      "category": "Network Security",
      "duration": "35 hours"
    },
    {
      "id": 3,
      "title": "Mobile Application Security Testing",
      "instructor": "Emily Davis",
      "progress": 90,
      "thumbnail": "/api/placeholder/300/200",
      "category": "Mobile Security",
      "duration": "30 hours"
    },
    {
      "id": 4,
      "title": "Cloud Security Fundamentals",
      "instructor": "David Wilson",
      "progress": 15,
      "thumbnail": "/api/placeholder/300/200",
      "category": "Cloud Security",
      "duration": "25 hours"
    }
  ],
  "certificates": [
    {
      "id": 1,
      "title": "Certified Ethical Hacker (CEH)",
      "completionDate": "2024-03-15",
      "thumbnail": "/api/placeholder/250/350",
      "verified": true
    },
    {
      "id": 2,
      "title": "OWASP Top 10 Specialist",
      "completionDate": "2024-02-28",
      "thumbnail": "/api/placeholder/250/350",
      "verified": true
    },
    {
      "id": 3,
      "title": "Vulnerability Assessment Professional",
      "completionDate": "2024-01-20",
      "thumbnail": "/api/placeholder/250/350",
      "verified": true
    }
  ],
  "achievements": [
    {
      "id": 1,
      "name": "First Steps",
      "description": "Completed your first course",
      "earned": true,
      "category": "Beginner",
      "color": "#10B981"
    },
    {
      "id": 2,
      "name": "Speed Learner",
      "description": "Completed 3 courses in a month",
      "earned": true,
      "category": "Progress",
      "color": "#3B82F6"
    },
    {
      "id": 3,
      "name": "Streak Master",
      "description": "Maintained 30-day learning streak",
      "earned": true,
      "category": "Consistency",
      "color": "#8B5CF6"
    },
    {
      "id": 4,
      "name": "Web Security Expert",
      "description": "Mastered web application security",
      "earned": true,
      "category": "Expertise",
      "color": "#EF4444"
    },
    {
      "id": 5,
      "name": "Network Ninja",
      "description": "Complete advanced network security",
      "earned": false,
      "progress": 45,
      "category": "Expertise",
      "color": "#F59E0B"
    },
    {
      "id": 6,
      "name": "Bug Hunter",
      "description": "Find and report 50 vulnerabilities",
      "earned": false,
      "progress": 72,
      "category": "Practice",
      "color": "#06B6D4"
    }
  ],
  "milestones": [
    {
      "title": "Learning Journey Started",
      "date": "2023-06-15",
      "completed": true,
      "icon": "üöÄ"
    },
    {
      "title": "First Course Completed",
      "date": "2023-07-20",
      "completed": true,
      "icon": "üéØ"
    },
    {
      "title": "10 Hour Study Milestone",
      "date": "2023-08-05",
      "completed": true,
      "icon": "‚è∞"
    },
    {
      "title": "First Certificate Earned",
      "date": "2024-01-20",
      "completed": true,
      "icon": "üèÜ"
    },
    {
      "title": "100 Hour Study Goal",
      "date": null,
      "completed": false,
      "progress": 85,
      "icon": "üìö"
    },
    {
      "title": "5 Certificates Goal",
      "date": null,
      "completed": false,
      "progress": 60,
      "icon": "üéñÔ∏è"
    }
  ]
};

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
  generateActivityChart();
  renderCourses();
  renderCertificates();
  renderAchievements();
  renderMilestones();
  initializeInteractions();
});

// Generate activity chart
function generateActivityChart() {
  const chartContainer = document.getElementById('activityChart');
  {% comment %} const weeklyData = appData.activity.weeklyData; {% endcomment %}
  fetch('/api/activity/')
  .then(res => res.json())
  .then(data => {
    appData.activity.weeklyData = data.weeklyData;
    generateActivityChart();  // regenerate heatmap
  });
  
  chartContainer.innerHTML = '';
  
  // Flatten the weekly data to get all days
  const allDays = weeklyData.flat();
  
  allDays.forEach((level, index) => {
    const day = document.createElement('div');
    day.className = `activity-day level-${level}`;
    day.setAttribute('data-level', level);
    day.setAttribute('data-day', index);
    
    // Add tooltip functionality
    const date = new Date();
    date.setDate(date.getDate() - (allDays.length - index));
    day.title = `${level} contributions on ${date.toDateString()}`;
    
    chartContainer.appendChild(day);
  });
}

// Render courses
function renderCourses() {
  const coursesGrid = document.getElementById('coursesGrid');
  coursesGrid.innerHTML = '';
  
  appData.courses.forEach(course => {
    const courseCard = document.createElement('div');
    courseCard.className = 'course-card';
    
    courseCard.innerHTML = `
      <img src="${course.thumbnail}" alt="${course.title}" class="course-card__image">
      <div class="course-card__content">
        <span class="course-card__category">${course.category}</span>
        <h4 class="course-card__title">${course.title}</h4>
        <p class="course-card__instructor">by ${course.instructor}</p>
        <div class="course-card__progress">
          <div class="progress-bar">
            <div class="progress-bar__fill" style="width: ${course.progress}%"></div>
          </div>
          <div class="progress-text">${course.progress}% complete ‚Ä¢ ${course.duration}</div>
        </div>
        <button class="btn btn--primary btn--full-width">
          ${course.progress === 100 ? 'Review Course' : 'Continue Learning'}
        </button>
      </div>
    `;
    
    coursesGrid.appendChild(courseCard);
  });
}

// Render certificates
function renderCertificates() {
  const certificatesGrid = document.getElementById('certificatesGrid');
  certificatesGrid.innerHTML = '';
  
  appData.certificates.forEach(certificate => {
    const certificateCard = document.createElement('div');
    certificateCard.className = 'certificate-card';
    
    const formattedDate = new Date(certificate.completionDate).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    certificateCard.innerHTML = `
      <img src="${certificate.thumbnail}" alt="${certificate.title}" class="certificate-card__image">
      <div class="certificate-card__content">
        <div class="certificate-card__header">
          <h4 class="certificate-card__title">${certificate.title}</h4>
          ${certificate.verified ? '<span class="verified-badge">Verified</span>' : ''}
        </div>
        <p class="certificate-card__date">Completed on ${formattedDate}</p>
        <div class="certificate-card__actions">
          <button class="btn btn--primary btn--sm">
            <i class="fas fa-download"></i> Download
          </button>
          <button class="btn btn--outline btn--sm">
            <i class="fas fa-share"></i> Share
          </button>
        </div>
      </div>
    `;
    
    certificatesGrid.appendChild(certificateCard);
  });
}

// Render achievements
function renderAchievements() {
  const achievementsGrid = document.getElementById('achievementsGrid');
  achievementsGrid.innerHTML = '';
  
  appData.achievements.forEach(achievement => {
    const achievementCard = document.createElement('div');
    achievementCard.className = `achievement-card ${achievement.earned ? 'earned' : ''}`;
    
    const badgeIcon = achievement.earned ? 'üèÜ' : 'üéØ';
    const opacity = achievement.earned ? '1' : '0.5';
    
    achievementCard.innerHTML = `
      <div class="achievement-badge" style="background-color: ${achievement.color}; opacity: ${opacity}">
        ${badgeIcon}
      </div>
      <h4 class="achievement-card__name">${achievement.name}</h4>
      <p class="achievement-card__description">${achievement.description}</p>
      ${!achievement.earned && achievement.progress ? `
        <div class="achievement-progress">
          <div class="progress-bar">
            <div class="progress-bar__fill" style="width: ${achievement.progress}%"></div>
          </div>
          <div class="progress-text">${achievement.progress}% complete</div>
        </div>
      ` : ''}
    `;
    
    achievementsGrid.appendChild(achievementCard);
  });
}

// Render milestones
function renderMilestones() {
  const milestonesTimeline = document.getElementById('milestonesTimeline');
  milestonesTimeline.innerHTML = '';
  
  appData.milestones.forEach(milestone => {
    const milestoneItem = document.createElement('div');
    milestoneItem.className = `milestone-item ${milestone.completed ? 'completed' : ''}`;
    
    const dateText = milestone.date ? 
      new Date(milestone.date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }) : 'In Progress';
    
    milestoneItem.innerHTML = `
      <div class="milestone-item__icon">${milestone.icon}</div>
      <h4 class="milestone-item__title">${milestone.title}</h4>
      <p class="milestone-item__date">${dateText}</p>
      ${!milestone.completed && milestone.progress ? `
        <div class="milestone-progress">
          <div class="progress-bar">
            <div class="progress-bar__fill" style="width: ${milestone.progress}%"></div>
          </div>
          <div class="progress-text">${milestone.progress}% complete</div>
        </div>
      ` : ''}
    `;
    
    milestonesTimeline.appendChild(milestoneItem);
  });
}

// Initialize interactions
function initializeInteractions() {
  // Add click handlers for buttons
  document.querySelectorAll('.btn').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      
      const buttonText = this.textContent.trim();
      
      // Handle different button actions
      switch(true) {
        case buttonText.includes('Continue Learning'):
        case buttonText.includes('Review Course'):
          showNotification('Redirecting to course...', 'info');
          break;
        case buttonText.includes('Download'):
          showNotification('Download started...', 'success');
          break;
        case buttonText.includes('Share'):
          showNotification('Share options opened...', 'info');
          break;
        case buttonText.includes('Edit Profile'):
          showNotification('Profile editor opened...', 'info');
          break;
        case buttonText.includes('View All'):
          showNotification('Loading all items...', 'info');
          break;
        case buttonText.includes('Download All'):
          showNotification('Downloading all certificates...', 'success');
          break;
        case buttonText.includes('Share Portfolio'):
          showNotification('Portfolio sharing options opened...', 'info');
          break;
      }
    });
  });
  
  // Add hover effects for activity chart
  document.querySelectorAll('.activity-day').forEach(day => {
    day.addEventListener('mouseenter', function() {
      this.style.transform = 'scale(1.2)';
      this.style.boxShadow = '0 0 8px rgba(0, 0, 0, 0.2)';
    });
    
    day.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1)';
      this.style.boxShadow = 'none';
    });
  });
  
  // Add smooth scroll for any anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth'
        });
      }
    });
  });
}

// Utility function to show notifications
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `notification notification--${type}`;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#2563EB'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    max-width: 300px;
  `;
  notification.textContent = message;
  
  // Add to document
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// Add some additional interactivity
document.addEventListener('DOMContentLoaded', function() {
  // Animate progress bars on scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver(function(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const progressBars = entry.target.querySelectorAll('.progress-bar__fill');
        progressBars.forEach(bar => {
          const width = bar.style.width;
          bar.style.width = '0%';
          bar.style.transition = 'width 1s ease-out';
          setTimeout(() => {
            bar.style.width = width;
          }, 100);
        });
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  // Observe sections with progress bars
  document.querySelectorAll('.courses-section, .achievements-section, .milestones-section').forEach(section => {
    observer.observe(section);
  });
});